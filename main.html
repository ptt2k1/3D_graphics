<!DOCTYPE html>
<html lang="en" xmlns:mso="urn:schemas-microsoft-com:office:office" xmlns:msdt="uuid:C2F41010-65B3-11d1-A29F-00AA00C14882">
<head>
    <meta charset="UTF-8">
    <title>DA2</title>
    <script src  = "thuvien/three.js"></script>
    <script src  = "thuvien/dat.gui.js"></script>
    <script src  = "thuvien/TrackballControls.js"></script>
    <script src  = "thuvien/OrbitControls.js"></script>
    <script src  = "thuvien/OBJLoader.js"></script>
    <script src  = "thuvien/MTLLoader.js"></script>
    <script src  = "learning-threejs-third/libs/three/renderers/CSS2DRenderer.js"></script>
    
    <style>
        body {
          margin: 0px;
          padding: 0px;
          max-width: 100vw;
          max-height: 100vh;
          overflow: hidden;
          font-family: sans-serif;
        }
        #popUp{
              background: white;
              max-width: 300px;
              padding: 1.5rem;
          }
        .message{
          position: fixed;
          z-index: 10;
          bottom: 1rem;
          left: 1rem;
        }
      </style>
</head>
<body>
<div id = "screen"></div>
<p class="message">Right click in a object to see a popup</p>
<!-- <canvas id="number" width="64" height="64"></canvas> -->
<script>
    function init(){
        //scene
        const scene = new THREE.Scene();

        //camera
        const cam = new THREE.PerspectiveCamera(45, window.innerWidth/window.innerHeight, 0.1, 1000);
        cam.position.set(0, 0, 50);
        cam.position.y = 50;
        cam.lookAt(scene.position);

        //render
        const renderer = new THREE.WebGLRenderer();
        renderer.setClearColor("#A0A0A0", 1);
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.querySelector("#screen").appendChild(renderer.domElement);
        renderer.shadowMapEnabled = true;

        //obit control
        let orbitControls = new THREE.OrbitControls(cam, renderer.domElement);

        //den chieu sang
        const lights = [];
        lights[0] = new THREE.PointLight(0xffffff, 1, 0);
        lights[1] = new THREE.PointLight(0xffffff, 1, 0);
        lights[2] = new THREE.PointLight(0xffffff, 1, 0);
        lights[3] = new THREE.PointLight(0xffffff, 1, 0);
        lights[4] = new THREE.PointLight(0xffffff, 1, 0);
        lights[5] = new THREE.PointLight(0xffffff, 1, 0);

        lights[0].position.set(0, 1000, 0);
        lights[1].position.set(0, 0, 1000);
        lights[2].position.set(0, 0, -1000);
        lights[3].position.set(0, -1000, 0);
        lights[4].position.set(1000, 0, 0);
        lights[5].position.set(-1000, 0, 0);

        scene.add(lights[0]);
        scene.add(lights[1]);
        scene.add(lights[2]);
        scene.add(lights[3]);
        scene.add(lights[4]);
        scene.add(lights[5]); 
        
        
        //add a cube
        let cubeGeom = new THREE.BoxGeometry(6, 6, 6, 1,1,1);
        let cubeColor = 0xea9b07;
        let cubeMat = new THREE.MeshLambertMaterial({color: cubeColor});
        let cubeMat2 = new THREE.MeshNormalMaterial();
        let cube = new THREE.Mesh(cubeGeom, cubeMat);
        cube.position.set(0,3,0);
        //cube.castShadow = true;
        //scene.add(cube);


        //add a sphere
        let sphereGeom = new THREE.SphereGeometry(10,64,64,0,2*Math.PI,0, Math.PI)
        let sphereMat =  new THREE.MeshLambertMaterial({
            color:"#66B2ff", wireframe:false,
            side:THREE.DoubleSide,
            shadowSide:THREE.DoubleSide
        });
        let sphereMat2 = new THREE.MeshNormalMaterial();
        let sphere = new THREE.Mesh(sphereGeom, sphereMat);


        //add a circle
        let circleGeom = new THREE.CircleGeometry(10, 64, 0, 2*Math.PI);
        let circleMat =  new THREE.MeshLambertMaterial({
            color:"#1e9b9b", wireframe:false,
            side:THREE.DoubleSide,
            shadowSide:THREE.DoubleSide
        });
        let circleMat2 = new THREE.MeshNormalMaterial();
        let circle = new THREE.Mesh(circleGeom, circleMat);


        //add a torus
        let torusGeom = new THREE.TorusGeometry(10,3,16,100,2*Math.PI)
        let torusMat =  new THREE.MeshLambertMaterial({
            color:"#66B2ff", wireframe:false,
            side:THREE.DoubleSide,
            shadowSide:THREE.DoubleSide
        });
        let torusMat2 = new THREE.MeshNormalMaterial();
        let torus = new THREE.Mesh(torusGeom, torusMat);

        //add a torus knot
        let torusknotGeom = new THREE.TorusKnotGeometry(12,3,24,160,3,4)
        let torusknotMat =  new THREE.MeshLambertMaterial({
            color:"#1c3259", wireframe:false,
            side:THREE.DoubleSide,
            shadowSide:THREE.DoubleSide
        });
        let torusknotMat2 = new THREE.MeshNormalMaterial();
        let torusknot = new THREE.Mesh(torusknotGeom, torusknotMat);


        //mo hinh heart
        const objLoader = new THREE.OBJLoader();
        const mtlLoader = new THREE.MTLLoader();

        const textureLoader = new THREE.TextureLoader();
        let Auricula_der = textureLoader.load("images/heart/der1.JPG");
        let Auricula_izq = textureLoader.load("images/heart/iqz1.JPG");
        let Auriculas_b = textureLoader.load("images/heart/Auriculas b.jpg");
        let Corazon_b02 = textureLoader.load("images/heart/Corazon_b02.jpg");
        let CorazonJamon2 = textureLoader.load("images/heart/CorazonJamon2.png");
        let Venitas = textureLoader.load("images/heart/Venitas.JPG");
        let Aorta = textureLoader.load("images/heart/aorta1.JPG");
        let Arteritas = textureLoader.load("images/heart/aorta1.JPG");

        let heart0 = new THREE.Mesh();
        let heart1 = new THREE.Mesh();
        let heart2 = new THREE.Mesh();
        let heart3 = new THREE.Mesh();
        let heart4 = new THREE.Mesh();
        let heart5 = new THREE.Mesh();

        mtlLoader.load("Human_heart.mtl", function(mats){
            mats.preload();
            objLoader.setMaterials(mats);
            objLoader.load("Human_heart.obj", onLoad); 
            function onLoad(mesh){
                /* mesh.children.forEach(function(child){
                    child.material.side = 2;
                    child.material.wireframe = true;
                    child.material.side = THREE.DoubleSide;
                }) */
                /* mesh.traverse(function(node){
                    if (node instanceof THREE.Mesh){
                        node.castShadow = true;
                        node.receiveShadow = true;
                    }
                }); */
                mesh.getObjectByName("Ventriculos").material[0].map = CorazonJamon2;
                mesh.getObjectByName("Ventriculos").material[0].specularMap = Corazon_b02;
                mesh.getObjectByName("Ventriculos").material[0].wireframe = false;
                mesh.getObjectByName("Ventriculos").material[0].color = new THREE.Color(0xffffff);
                mesh.getObjectByName("Ventriculos").material[0].shininess = 0;
                mesh.getObjectByName("Ventriculos").material[0].name = "Tam that";

                mesh.getObjectByName("Ventriculos").material[1].map = CorazonJamon2;
                mesh.getObjectByName("Ventriculos").material[1].specularMap = Corazon_b02;
                mesh.getObjectByName("Ventriculos").material[1].wireframe = false;
                mesh.getObjectByName("Ventriculos").material[1].color = new THREE.Color(0xffffff);
                mesh.getObjectByName("Ventriculos").material[1].shininess = 0;
                mesh.getObjectByName("Ventriculos").material[1].name = "Tam that";

                mesh.getObjectByName("Auricula_der").material.map = Auricula_der;
                mesh.getObjectByName("Auricula_der").material.specularMap = Auriculas_b;
                mesh.getObjectByName("Auricula_der").material.wireframe = false;
                mesh.getObjectByName("Auricula_der").material.color = new THREE.Color(0xffffff);
                mesh.getObjectByName("Auricula_der").material.shininess = 0;
                mesh.getObjectByName("Auricula_der").material.name = "Tam nhi trai";

                mesh.getObjectByName("Auricula_izq").material.map = Auricula_izq;
                mesh.getObjectByName("Auricula_izq").material.specularMap = Auriculas_b;
                mesh.getObjectByName("Auricula_izq").material.wireframe = false;
                mesh.getObjectByName("Auricula_izq").material.color = new THREE.Color(0xffffff);
                mesh.getObjectByName("Auricula_izq").material.shininess = 0;
                mesh.getObjectByName("Auricula_izq").material.name = "Tam nhi phai";

                mesh.getObjectByName("Venitas").material.map = Venitas;
                mesh.getObjectByName("Venitas").material.wireframe = false;
                mesh.getObjectByName("Venitas").material.color = new THREE.Color(0xffffff);
                mesh.getObjectByName("Venitas").material.shininess = 0;
                mesh.getObjectByName("Venitas").material.name = "Tinh mach";

                mesh.getObjectByName("Aorta").material.map = Aorta;
                mesh.getObjectByName("Aorta").material.wireframe = false;
                mesh.getObjectByName("Aorta").material.color = new THREE.Color(0xffffff);
                mesh.getObjectByName("Aorta").material.shininess = 0;
                mesh.getObjectByName("Aorta").material.name = "Dong mach chu";
                
                mesh.getObjectByName("Arteritas").material.map = Arteritas;
                mesh.getObjectByName("Arteritas").material.wireframe = false;
                mesh.getObjectByName("Arteritas").material.color = new THREE.Color(0xffffff);
                mesh.getObjectByName("Arteritas").material.shininess = 0;
                mesh.getObjectByName("Arteritas").material.name = "Dong mach phoi"; 

                heart0 = mesh.children[0];
                heart1 = mesh.children[1];
                heart2 = mesh.children[2];
                heart3 = mesh.children[3];
                heart4 = mesh.children[4];
                heart5 = mesh.children[5];

                //objects = [...objects, heart0, heart1, heart2, heart3, heart4, heart5];

                //mesh.scale.set(80,80,80);
                mesh.rotateX(-Math.PI/2);
                mesh.rotateY(Math.PI/6);
                mesh.rotateZ(Math.PI/2)
                //mesh.position.set(0,3,0);
                //scene.add(mesh);
                console.log(mesh);
            } 
            //objLoader.castShadow = true;   
        });

        //model brain
        const objLoader_brain = new THREE.OBJLoader();
        const mtlLoader_brain = new THREE.MTLLoader();

        let brain = new THREE.Mesh();

        let texture = textureLoader.load("images/brain/albedo.jpg");
        let normal = textureLoader.load("images/brain/Normal_DirectX.jpg");
        let specular = textureLoader.load("images/brain/Mixed_AO.jpg");

        mtlLoader_brain.load("Human_brain.mtl", function(mats){
            mats.preload();
            objLoader_brain.setMaterials(mats);
            objLoader_brain.load("Human_brain.obj", onLoad); 
            function onLoad(mesh){
                /* mesh.traverse(function(node){
                    if (node instanceof THREE.Mesh){
                        node.castShadow = true;
                        node.receiveShadow = true;
                    }
                }); */
                /* mesh.children[0].material = new THREE.MeshStandardMaterial({
                    map:texture,
                    normalMap:normal,
                    side:THREE.DoubleSide,
                    shadowSide:THREE.DoubleSide
                }); */
                mesh.children[0].material.color = new THREE.Color(0xffffff);
                mesh.children[0].material.map = texture;
                mesh.children[0].material.normalMap = normal;
                mesh.children[0].material.specularMap = specular;
                mesh.children[0].material.name = "Brain";

                
                //mesh.scale.set(80,80,80);
                //mesh.rotateX(Math.PI/2);
                //mesh.rotateY(Math.PI/6);
                //mesh.rotateZ(Math.PI/2)
                //mesh.position.set(0,3,0);
                //scene.add(mesh);
                brain = mesh.children[0];
                //objects = [...objects, brain];
                //console.log(mesh);
            } 
            //objLoader.castShadow = true;   
        });

        //model lungs
        const objLoader_lung = new THREE.OBJLoader();
        const mtlLoader_lung = new THREE.MTLLoader();

        let lung0 = new THREE.Mesh();
        let lung1 = new THREE.Mesh();
        let lung2 = new THREE.Mesh();
        let lung3 = new THREE.Mesh();
        let lung4 = new THREE.Mesh();
        let lung5 = new THREE.Mesh();
        mtlLoader_lung.load("Human_lung.mtl", function(mats){
            mats.preload();
            objLoader_lung.setMaterials(mats);
            objLoader_lung.load("Human_lung.obj", onLoad); 
            function onLoad(mesh){
                mesh.children.forEach(function(child){
                    child.material.side = THREE.DoubleSide;  
                    child.material.shadowSide = THREE.DoubleSide; 
                    child.rotateX(-Math.PI/1.5);   
                    child.scale.set(5,5,5);
                    child.position.set(-10,0,0);           
                })
                /* mesh.traverse(function(node){
                    if (node instanceof THREE.Mesh){
                        node.castShadow = true;
                        node.receiveShadow = true;
                    }
                }); */

                mesh.children[0].material.color = new THREE.Color(0x664c4c);
                mesh.children[0].material.name = "bronchi1";

                mesh.children[1].material.color = new THREE.Color(0x702c2c);
                mesh.children[1].material.name = "Linkerlong";

                mesh.children[2].material.color = new THREE.Color(0x3d503c);
                mesh.children[2].material.name = "Trachea_kraakbeen";

                mesh.children[3].material.color = new THREE.Color(0x3d503c);
                mesh.children[3].material.name = "Tussen_hyoid_en_thyroid";

                mesh.children[4].material.color = new THREE.Color(0x3d503c);
                mesh.children[4].material.name = "Hyoid_bone";

                mesh.children[5].material.color = new THREE.Color(0x643a3a);    
                mesh.children[5].material.name = "Thyroid_gland";          


                lung0 = mesh.children[0];
                lung1 = mesh.children[1];
                lung2 = mesh.children[2];
                lung3 = mesh.children[3];
                lung4 = mesh.children[4];
                lung5 = mesh.children[5];

                //objects = [...objects, lung0, lung1, lung2, lung3, lung4, lung5];

                //mesh.scale.set(80,80,80);
                //mesh.rotateX(-Math.PI/2);
                //mesh.rotateY(Math.PI/6);
                //mesh.rotateZ(Math.PI/2)
                //mesh.position.set(0,3,0);
                //scene.add(mesh);
                //console.log(mesh);
            } 
            //objLoader.castShadow = true;   
        });

        let u10 = new THREE.Mesh();
        let u11 = new THREE.Mesh();
        let u12 = new THREE.Mesh();
        let u13 = new THREE.Mesh();
        let u14 = new THREE.Mesh();
        let u15 = new THREE.Mesh();
        let u16 = new THREE.Mesh();
        let u17 = new THREE.Mesh();
        let u18 = new THREE.Mesh();

        mtlLoader.load("untitled1.mtl", function(mats){
            mats.preload();
            objLoader.setMaterials(mats);
            objLoader.load("untitled1.obj", onLoad); 
            function onLoad(mesh){
                mesh.children.forEach(function(child){
                    child.material.side = 2;
                    //child.material.color = 0xffffff;
                    //mat.side = 2;
                    child.material.side = THREE.DoubleSide;                 
                })
                /* mesh.traverse(function(node){
                    if (node instanceof THREE.Mesh){
                        node.castShadow = true;
                        node.receiveShadow = true;
                    }
                }); */

                mesh.children[0].material.color = new THREE.Color("#664c4c");
                mesh.children[1].material.color = new THREE.Color(0x702c2c);
                mesh.children[2].material.color = new THREE.Color(0x3d503c);
                mesh.children[3].material.color = new THREE.Color(0x3d503c);
                mesh.children[4].material.color = new THREE.Color(0x3d503c);
                //mesh.children[5].material.color = new THREE.Color(0x643a3a); 
                //mesh.children[6].material.color = new THREE.Color(0x643a3a);
                //mesh.children[7].material.color = new THREE.Color(0x643a3a);
                //mesh.children[8].material.color = new THREE.Color(0x643a3a);             

                u10 = mesh.children[0];
                u11 = mesh.children[1];
                u12 = mesh.children[2];
                u13 = mesh.children[3];
                u14 = mesh.children[4];
                u15 = mesh.children[5];
                u16 = mesh.children[6];
                u17 = mesh.children[7];
                u18 = mesh.children[8];

                u10.rotateX(-Math.PI/1.5);
                u11.rotateX(-Math.PI/1.5);
                u12.rotateX(-Math.PI/1.5);
                u13.rotateX(-Math.PI/1.5);
                u14.rotateX(-Math.PI/1.5);
                u15.rotateX(-Math.PI/1.5);
                u16.rotateX(-Math.PI/1.5);
                u17.rotateX(-Math.PI/1.5);
                u18.rotateX(-Math.PI/1.5);

                //mesh.scale.set(80,80,80);
                //mesh.rotateX(-Math.PI/2);
                //mesh.rotateY(Math.PI/6);
                //mesh.rotateZ(Math.PI/2)
                //mesh.position.set(0,3,0);
                //scene.add(mesh);
                console.log(mesh);
            } 
            //objLoader.castShadow = true;   
        });

        let u0 = new THREE.Mesh();
        let u1 = new THREE.Mesh();
        let u2 = new THREE.Mesh();
        let u3 = new THREE.Mesh();
        let u4 = new THREE.Mesh();


        mtlLoader.load("untitled.mtl", function(mats){
            mats.preload();
            objLoader.setMaterials(mats);
            objLoader.load("untitled.obj", onLoad); 
            function onLoad(mesh){
                mesh.children.forEach(function(child){
                    child.material.side = 2;
                    //child.material.color = 0xffffff;
                    //mat.side = 2;
                    child.material.side = THREE.DoubleSide;                 
                })
                /* mesh.traverse(function(node){
                    if (node instanceof THREE.Mesh){
                        node.castShadow = true;
                        node.receiveShadow = true;
                    }
                }); */

                mesh.children[0].material.color = new THREE.Color("#664c4c");
                mesh.children[1].material.color = new THREE.Color(0x702c2c);
                mesh.children[2].material.color = new THREE.Color(0x3d503c);
                mesh.children[3].material.color = new THREE.Color(0x3d503c);
                mesh.children[4].material.color = new THREE.Color(0x3d503c);
                //mesh.children[5].material.color = new THREE.Color(0x643a3a);              


                u0 = mesh.children[0];
                u1 = mesh.children[1];
                u2 = mesh.children[2];
                u3 = mesh.children[3];
                u4 = mesh.children[4];

                u0.rotateX(-Math.PI/2);
                u1.rotateX(-Math.PI/2);
                u2.rotateX(-Math.PI/2);
                u3.rotateX(-Math.PI/2);
                u4.rotateX(-Math.PI/2);

                //mesh.scale.set(80,80,80);
                //mesh.rotateX(-Math.PI/2);
                //mesh.rotateY(Math.PI/6);
                //mesh.rotateZ(Math.PI/2)
                //mesh.position.set(0,3,0);
                //scene.add(mesh);
                console.log(mesh);
            } 
            //objLoader.castShadow = true;   
        });


        //GIAO DIEN CHINH SUA
        let controls = new function(){
            this.background = 0xA0A0A0;
            this.options = "math";
            this.models = "Brain";
            this.geometry = "Cube";

            //model heart
            this.color_01 = 0xffffff;
            this.color_Au = 0xffffff;
            this.color_A = 0xffffff;
            this.color_V = 0xffffff;
            this.emissive = 0x000000;
            this.specular = 0x000000;
            this.shininess = 0;
            this.visible0 = true;
            this.visible1 = true;
            this.visible2 = true;
            this.visible3 = true;
            this.visible4 = true;
            this.visible5 = true;
            this.wireframe = false;
            this.side = 2;
            this.shadowSide =2;
            this.rotate = false;
            this.reset_heart = function(){
                scene.remove(heart0);
                scene.remove(heart1);
                scene.remove(heart2);
                scene.remove(heart3);
                scene.remove(heart4);
                scene.remove(heart5);

                scene.add(heart0);
                scene.add(heart1);
                scene.add(heart2);
                scene.add(heart3);
                scene.add(heart4);
                scene.add(heart5);

            };

            //cube
            this.material_cube = 0;
            this.color_cube = 0xea9b07;
            this.width_cube = cube.geometry.parameters.width;
            this.height_cube = cube.geometry.parameters.height;
            this.depth_cube = cube.geometry.parameters.depth;
            this.widthSegments_cube = cube.geometry.parameters.widthSegments;
            this.heightSegments_cube = cube.geometry.parameters.heightSegments;
            this.depthSegments_cube = cube.geometry.parameters.depthSegments;
            this.wireframe_cube = false;
            this.side_cube = 2;
            this.shadowSide_cube =2;
            this.rotate_cube = false;
            this.redraw_cube = function(){
                scene.remove(cube);
                cubeGeom = new THREE.BoxGeometry(controls.width_cube, controls.height_cube,controls.depth_cube, controls.widthSegments_cube, controls.heightSegments_cube, controls.depthSegments_cube);
                cube = new THREE.Mesh(cubeGeom, cubeMat);
                scene.add(cube)
            };

            //sphere
            this.material_sphere = 0;
            this.color_sphere = 0x66B2ff;
            this.radius = sphere.geometry.parameters.radius;
            this.widthSegments = sphere.geometry.parameters.widthSegments;
            this.heightSegments = sphere.geometry.parameters.heightSegments;
            this.phiStart = sphere.geometry.parameters.phiStart;
            this.phiLength = sphere.geometry.parameters.phiLength;
            this.thetaStart = sphere.geometry.parameters.thetaStart;
            this.thetaLength = sphere.geometry.parameters.thetaLength;
            this.wireframe_sphere = false;
            this.side_sphere = 2;
            this.shadowSide_sphere =2;
            this.rotate_sphere = false;
            this.redraw = function() {
                scene.remove(sphere);
                sphereGeom = new THREE.SphereGeometry(controls.radius,controls.widthSegments,controls.heightSegments,controls.phiStart,controls.phiLength, controls.thetaStart, controls.thetaLength);
                sphere = new THREE.Mesh(sphereGeom, sphereMat);
                scene.add(sphere);
                //sphere.rotateX(Math.PI / 6);
                //sphere.rotateY(Math.PI / 6);
                //sphere.position.set(0, 0, 10);
                //sphere.castShadow = controls.castShadow;
            }

            //circle
            this.material_circle = 0;
            this.color_circle = 0x1e9b9b;
            this.radius_circle = circle.geometry.parameters.radius;
            this.segments_circle = circle.geometry.parameters.segments;
            this.thetaStart_circle = circle.geometry.parameters.thetaStart;
            this.thetaLength_circle = circle.geometry.parameters.thetaLength;
            this.wireframe_circle = false;
            this.side_circle = 2;
            this.shadowSide_circle =2;
            this.rotate_circle = false;
            this.redraw_circle = function() {
                scene.remove(circle);
                circleGeom = new THREE.CircleGeometry(controls.radius_circle, controls.segments_circle, controls.thetaStart_circle, controls.thetaLength_circle);
                circle = new THREE.Mesh(circleGeom, circleMat);
                scene.add(circle);
                //circle.rotateX(Math.PI / 6);
                //circle.rotateY(Math.PI / 6);
                //circle.position.set(0, 0, 10);
                //circle.castShadow = controls.castShadow;
            }

            //torus
            this.material_torus = 0;
            this.color_torus = 0x66B2ff;
            this.radius_torus = torus.geometry.parameters.radius;
            this.tube_torus = torus.geometry.parameters.tube;
            this.radialSegments_torus = torus.geometry.parameters.radialSegments;
            this.tubularSegments_torus = torus.geometry.parameters.tubularSegments;
            this.arc_torus = torus.geometry.parameters.arc;
            this.wireframe_torus = false;
            this.side_torus = 2;
            this.shadowSide_torus =2;
            this.rotate_torus = false;
            this.redraw_torus = function() {
                scene.remove(torus);
                torusGeom = new THREE.TorusGeometry(controls.radius_torus, controls.tube_torus, controls.radialSegments_torus, controls.tubularSegments_torus, controls.arc_torus);
                torus = new THREE.Mesh(torusGeom, torusMat);
                scene.add(torus);
                //torus.rotateX(Math.PI / 6);
                //torus.rotateY(Math.PI / 6);
                //torus.position.set(0, 0, 10);
                //torus.castShadow = controls.castShadow;
            }
    
            //torusKnot
            this.material_torusknot = 0;
            this.color_torusknot = 0x66B2ff;
            this.radius_torusknot = torusknot.geometry.parameters.radius;
            this.tube_torusknot = torusknot.geometry.parameters.tube;
            this.radialSegments_torusknot = torusknot.geometry.parameters.radialSegments;
            this.tubularSegments_torusknot = torusknot.geometry.parameters.tubularSegments;
            this.p_torusknot = torusknot.geometry.parameters.p;
            this.q_torusknot = torusknot.geometry.parameters.q;
            this.wireframe_torusknot = false;
            this.side_torusknot = 2;
            this.shadowSide_torusknot =2;
            this.rotate_torusknot = false;
            this.redraw_torusknot = function() {
                scene.remove(torusknot);
                torusknotGeom = new THREE.TorusKnotGeometry(controls.radius_torusknot, controls.tube_torusknot, controls.radialSegments_torusknot, controls.tubularSegments_torusknot, controls.p_torusknot, controls.q_torusknot);
                torusknot = new THREE.Mesh(torusknotGeom, torusknotMat);
                scene.add(torusknot);
                //torusknot.rotateX(Math.PI / 6);
                //torusknot.rotateY(Math.PI / 6);
                //torusknot.position.set(0, 0, 10);
                //torusknot.castShadow = controls.castShadow;
            }

            //Brain
            this.color_brain = 0xffffff;
            this.emissive_brain = 0x000000;
            this.specular_brain = 0x000000;
            this.shininess_brain = 0;
            this.visible_brain = true;
            this.wireframe_brain = false;
            this.side_brain = 2;
            this.shadowSide_brain =2;
            this.rotate_brain = false;

            //Lungs
            this.color0_lung = 0x664c4c;
            this.color1_lung = 0x702c2c;
            this.color234_lung = 0x3d503c;
            this.color5_lung = 0x643a3a;
            this.emissive_lung = 0x000000;
            this.specular_lung = 0x000000;
            this.shininess_lung = 0;
            this.wireframe_lung = false;
            this.visible0_lung = true;
            this.visible1_lung = true;
            this.visible2_lung = true;
            this.visible3_lung = true;
            this.visible4_lung= true;
            this.visible5_lung = true;
            this.side_lung = 2;
            this.shadowSide_lung =2;
            this.rotate_lung = false;

            //u1
            this.color0_u1 = 0xd71b1b;
            this.color1_u1 = 0x21b34c;
            this.color2_u1 = 0x1eafaf;
            this.color3_u1 = 0x1eafaf;
            this.color4_u1 = 0xc513bb;
            this.color5_u1 = 0x21b34c;
            this.color6_u1 = 0x1eafaf;
            this.color7_u1 = 0x1eafaf;
            this.color8_u1 = 0xc513bb;
            this.emissive_u1 = 0x000000;
            this.specular_u1 = 0x000000;
            this.shininess_u1 = 0;
            this.wireframe_u1 = false;
            this.visible0_u1 = true;
            this.visible1_u1 = true;
            this.visible2_u1 = true;
            this.visible3_u1 = true;
            this.visible4_u1 = true;
            this.visible5_u1 = true;
            this.visible6_u1 = true;
            this.visible7_u1 = true;
            this.visible8_u1 = true;
            this.side_u1 = 2;
            this.shadowSide_u1 =2;
            this.rotate_u1 = false;

            //u
            this.color0_u = 0xd71b1b;
            this.color1_u = 0x21b34c;
            this.color2_u = 0x1eafaf;
            this.color3_u = 0x1eafaf;
            this.color4_u = 0xc513bb;
        
            this.emissive_u = 0x000000;
            this.specular_u = 0x000000;
            this.shininess_u = 0;
            this.wireframe_u = false;
            this.visible0_u = true;
            this.visible1_u = true;
            this.visible2_u = true;
            this.visible3_u = true;
            this.visible4_u = true;
     
            this.side_u = 2;
            this.shadowSide_u =2;
            this.rotate_u = false;
        }

        let objects = [];
        function lis_object(e){
            objects = [];       
            if (e == 0){
                objects = [...objects,brain];
            } 
            else if(e == 1){
                objects = [...objects,heart0, heart1, heart2, heart3, heart4, heart5];
            } 
            else if(e == 2){
                objects = [...objects,lung0, lung1, lung2, lung3, lung4, lung5];
            }
            else if(e == 3){
                objects = [...objects,u10, u11, u12, u13, u14, u15, u16, u17, u18];
            }
            else {
                objects = [...objects,u0, u1, u2, u3, u4];
            }
            return objects;
        }

        //THIET LAP GIAO DIEN
        dat.GUI.prototype.removeFolder = function(name) {
            var folder = this.__folders[name];
            if (!folder) {
                return;
            }
            folder.close();
            this.__ul.removeChild(folder.domElement.parentNode);
            delete this.__folders[name];
            this.onResize();
        };
        
        const gui_main = new dat.GUI();
        gui_main.addColor(controls, "background").onChange(function(e){
            renderer.setClearColor(e);
        });
        let DropList = gui_main.add(controls, "options", {"medicine":0, "math":1});
        DropList.setValue(1);
        DropList.onChange(function(e){
            if(e==0){
                scene.remove(cube);
                scene.remove(sphere);
                scene.remove(circle);
                scene.remove(torus);
                scene.remove(torusknot);
                //scene.add(cube);
                gui_main.removeFolder("Math");
                const gui = gui_main.addFolder("Medicine");
                let dropList = gui.add(controls, "models", {"Brain":0, "Heart":1, "Lungs":2, "Gastrointestinal tract":3, "Lymphatic System":4});
                dropList.setValue(0);
                dropList.onChange(function(e){
                    if (e==0){
                        scene.remove(heart0);
                        scene.remove(heart1);
                        scene.remove(heart2);
                        scene.remove(heart3);
                        scene.remove(heart4);
                        scene.remove(heart5);
                        scene.remove(lung0);
                        scene.remove(lung1);
                        scene.remove(lung2);
                        scene.remove(lung3);
                        scene.remove(lung4);
                        scene.remove(lung5);
                        scene.remove(u10);
                        scene.remove(u11);
                        scene.remove(u12);
                        scene.remove(u13);
                        scene.remove(u14);
                        scene.remove(u15);
                        scene.remove(u16);
                        scene.remove(u17);
                        scene.remove(u18);
                        scene.remove(u0);
                        scene.remove(u1);
                        scene.remove(u2);
                        scene.remove(u3);
                        scene.remove(u4);
                        gui.removeFolder("Lymphatic System");
                        gui.removeFolder("Gastrointestinal tract");
                        gui.removeFolder("Lungs");
                        gui.removeFolder("Heart");

                        objects = lis_object(0);
                        scene.add(brain);
                        const aGUI = gui.addFolder("Brain");
                       aGUI.add(controls, "visible_brain",true,false).onChange(function(e){
                            brain.visible = e;
                        });
                        
                       aGUI.addColor(controls, "color_brain").onChange(function(e){
                            brain.material.color = new THREE.Color(e);
                        });

                       aGUI.addColor(controls, "emissive_brain").onChange(function(e){
                            brain.material.emissive = new THREE.Color(e);
                        });
                       aGUI.addColor(controls, "specular_brain").onChange(function(e){
                            brain.material.specular = new THREE.Color(e);
                        });
                       aGUI.add(controls, "shininess_brain",0,200).onChange(function(e){
                            brain.material.shininess = e;
                        });
                       aGUI.add(controls, "wireframe_brain", true, false).onChange(function(e){
                            brain.material.wireframe = e;
                        });
                       aGUI.add(controls, "side_brain", {FrontSide:0, BackSide:1, BothSide:2}).onChange(function(e){
                            brain.material.side  = parseInt(e);
                        });
                       aGUI.add(controls, "shadowSide_brain", {FrontSide:0, BackSide:1, BothSide:2}).onChange(function(e){
                            brain.material.shadowSide  = parseInt(e);
                        });
                       aGUI.add(controls, "rotate_brain", true, false);

                        //selectedMesh = cube;
                    } 
                    else if (e==1){
                        scene.remove(brain);
                        scene.remove(lung0);
                        scene.remove(lung1);
                        scene.remove(lung2);
                        scene.remove(lung3);
                        scene.remove(lung4);
                        scene.remove(lung5);
                        gui.removeFolder("Lungs");
                        gui.removeFolder("Brain");
                        scene.remove(u10);
                        scene.remove(u11);
                        scene.remove(u12);
                        scene.remove(u13);
                        scene.remove(u14);
                        scene.remove(u15);
                        scene.remove(u16);
                        scene.remove(u17);
                        scene.remove(u18);
                        gui.removeFolder("Gastrointestinal tract");
                        scene.remove(u0);
                        scene.remove(u1);
                        scene.remove(u2);
                        scene.remove(u3);
                        scene.remove(u4);
                        gui.removeFolder("Lymphatic System");

                        scene.add(heart0);
                        scene.add(heart1);
                        scene.add(heart2);
                        scene.add(heart3);
                        scene.add(heart4);
                        scene.add(heart5); 
                        objects = lis_object(1);
            
                        const aGUI = gui.addFolder("Heart");
                        aGUI.add(controls, "reset_heart");
                        const a1GUI = aGUI.addFolder("color");
                        aGUI.add(controls, "rotate", true, false);
                        a1GUI.addColor(controls, "color_01").onChange(function(e){
                            heart0.material[1].color = new THREE.Color(e);
                        });
                        a1GUI.addColor(controls, "color_Au").onChange(function(e){
                            heart1.material.color = new THREE.Color(e);
                            heart2.material.color = new THREE.Color(e);
                        });
                        a1GUI.addColor(controls, "color_A").onChange(function(e){
                            heart4.material.color = new THREE.Color(e);
                            heart5.material.color = new THREE.Color(e);
                        });   
                        
                        a1GUI.addColor(controls, "color_V").onChange(function(e){
                            heart0.material[0].color = new THREE.Color(e);
                            heart3.material.color = new THREE.Color(e);
                        });

                        const a2GUI = aGUI.addFolder("visible");
                        a2GUI.add(controls, "visible0",true,false).onChange(function(e){
                            heart0.visible = e;
                        });
                        a2GUI.add(controls, "visible1",true,false).onChange(function(e){
                            heart1.visible = e;
                        });
                        a2GUI.add(controls, "visible2",true,false).onChange(function(e){
                            heart2.visible = e;
                        });
                        a2GUI.add(controls, "visible3",true,false).onChange(function(e){
                            heart3.visible = e;
                        });
                        a2GUI.add(controls, "visible4",true,false).onChange(function(e){
                            heart4.visible = e;
                        });
                        a2GUI.add(controls, "visible5",true,false).onChange(function(e){
                            heart5.visible = e;
                        });

                        aGUI.add(controls, "side", {FrontSide:0, BackSide:1, BothSide:2}).onChange(function(e){
                            heart0.material[0].side  = parseInt(e);
                            heart0.material[1].side  = parseInt(e);
                            heart1.material.side  = parseInt(e);
                            heart2.material.side  = parseInt(e);
                            heart3.material.side  = parseInt(e);
                            heart4.material.side  = parseInt(e);
                            heart5.material.side  = parseInt(e);
                        });
                        aGUI.add(controls, "shadowSide", {FrontSide:0, BackSide:1, BothSide:2}).onChange(function(e){
                            heart0.material[0].shadowSide  = parseInt(e);
                            heart0.material[1].shadowSide  = parseInt(e);
                            heart1.material.shadowSide  = parseInt(e);
                            heart2.material.shadowSide  = parseInt(e);
                            heart3.material.shadowSide  = parseInt(e);
                            heart4.material.shadowSide  = parseInt(e);
                            heart5.material.shadowSide  = parseInt(e);
                        }); 

                        aGUI.addColor(controls, "emissive").onChange(function(e){
                            heart0.material[0].emissive = new THREE.Color(e);
                            heart0.material[1].emissive = new THREE.Color(e);
                            heart1.material.emissive = new THREE.Color(e);
                            heart2.material.emissive = new THREE.Color(e);
                            heart3.material.emissive = new THREE.Color(e);
                            heart4.material.emissive = new THREE.Color(e);
                            heart5.material.emissive = new THREE.Color(e);
                        });
                        aGUI.addColor(controls, "specular").onChange(function(e){
                            heart0.material[0].specular = new THREE.Color(e);
                            heart0.material[1].specular = new THREE.Color(e);
                            heart1.material.specular = new THREE.Color(e);
                            heart2.material.specular = new THREE.Color(e);
                            heart3.material.specular = new THREE.Color(e);
                            heart4.material.specular = new THREE.Color(e);
                            heart5.material.specular = new THREE.Color(e);
                        });
                        aGUI.add(controls, "shininess",0,200).onChange(function(e){
                            heart0.material[0].shininess = e;
                            heart0.material[1].shininess = e;
                            heart1.material.shininess = e;
                            heart2.material.shininess = e;
                            heart3.material.shininess = e;
                            heart4.material.shininess = e;
                            heart5.material.shininess = e;
                        });
                        aGUI.add(controls, "wireframe", true, false).onChange(function(e){
                            heart0.material[0].wireframe = e;
                            heart0.material[1].wireframe = e;
                            heart1.material.wireframe = e;
                            heart2.material.wireframe = e;
                            heart3.material.wireframe = e;
                            heart4.material.wireframe = e;
                            heart5.material.wireframe = e;
                        });

                        //selectedMesh = heart0;
                    }
                    else if (e == 2) {
                        scene.remove(heart0);
                        scene.remove(heart1);
                        scene.remove(heart2);
                        scene.remove(heart3);
                        scene.remove(heart4);
                        scene.remove(heart5);
                        scene.remove(brain);
                        gui.removeFolder("Brain");
                        gui.removeFolder("Heart");
                        scene.remove(u10);
                        scene.remove(u11);
                        scene.remove(u12);
                        scene.remove(u13);
                        scene.remove(u14);
                        scene.remove(u15);
                        scene.remove(u16);
                        scene.remove(u17);
                        scene.remove(u18);
                        gui.removeFolder("Gastrointestinal tract");
                        scene.remove(u0);
                        scene.remove(u1);
                        scene.remove(u2);
                        scene.remove(u3);
                        scene.remove(u4);
                        gui.removeFolder("Lymphatic System");

                        scene.add(lung0);
                        scene.add(lung1);
                        scene.add(lung2);
                        scene.add(lung3);
                        scene.add(lung4);
                        scene.add(lung5);

                        objects = lis_object(2);
                        const aGUI = gui.addFolder("Lungs");
                        const a1GUI = aGUI.addFolder("color");
                        a1GUI.addColor(controls, "color0_lung").onChange(function(e){
                            lung0.material.color = new THREE.Color(e);
                        });
                        a1GUI.addColor(controls, "color1_lung").onChange(function(e){
                            lung1.material.color = new THREE.Color(e);
                        });
                        a1GUI.addColor(controls, "color234_lung").onChange(function(e){
                            lung2.material.color = new THREE.Color(e);
                            lung3.material.color = new THREE.Color(e);
                            lung4.material.color = new THREE.Color(e);
                        });
                        a1GUI.addColor(controls, "color5_lung").onChange(function(e){
                            lung5.material.color = new THREE.Color(e);
                        });

                        const a2GUI = aGUI.addFolder("visible");
                        a2GUI.add(controls, "visible0_lung",true,false).onChange(function(e){
                            lung0.visible = e;
                        });
                        a2GUI.add(controls, "visible1_lung",true,false).onChange(function(e){
                            lung1.visible = e;
                        });
                        a2GUI.add(controls, "visible2_lung",true,false).onChange(function(e){
                            lung2.visible = e;
                        });
                        a2GUI.add(controls, "visible3_lung",true,false).onChange(function(e){
                            lung3.visible = e;
                        });
                        a2GUI.add(controls, "visible4_lung",true,false).onChange(function(e){
                            lung4.visible = e;
                        });
                        a2GUI.add(controls, "visible5_lung",true,false).onChange(function(e){
                            lung5.visible = e;
                        });
                        aGUI.add(controls, "wireframe_lung", true, false).onChange(function(e){
                            lung1.material.wireframe = e;
                            lung2.material.wireframe = e;
                            lung0.material.wireframe = e;
                            lung3.material.wireframe = e;
                            lung4.material.wireframe = e;
                            lung5.material.wireframe = e;
                        });
                        aGUI.add(controls, "side_lung", {FrontSide:0, BackSide:1, BothSide:2}).onChange(function(e){
                            lung0.material.side  = parseInt(e);
                            lung1.material.side  = parseInt(e);
                            lung2.material.side  = parseInt(e);
                            lung3.material.side  = parseInt(e);
                            lung4.material.side  = parseInt(e);
                            lung5.material.side  = parseInt(e);
                        });
                        aGUI.add(controls, "shadowSide_lung", {FrontSide:0, BackSide:1, BothSide:2}).onChange(function(e){
                            lung0.material.shadowSide  = parseInt(e);
                            lung1.material.shadowSide  = parseInt(e);
                            lung2.material.shadowSide  = parseInt(e);
                            lung3.material.shadowSide  = parseInt(e);
                            lung4.material.shadowSide  = parseInt(e);
                            lung5.material.shadowSide  = parseInt(e);
                        });
                        aGUI.add(controls, "rotate_lung", true, false);
                        

                        aGUI.addColor(controls, "emissive_lung").onChange(function(e){
                            lung0.material.emissive = new THREE.Color(e);
                            lung1.material.emissive = new THREE.Color(e);
                            lung2.material.emissive = new THREE.Color(e);
                            lung3.material.emissive = new THREE.Color(e);
                            lung4.material.emissive = new THREE.Color(e);
                            lung5.material.emissive = new THREE.Color(e);
                        });
                        aGUI.addColor(controls, "specular_lung").onChange(function(e){
                            lung0.material.specular = new THREE.Color(e);
                            lung1.material.specular = new THREE.Color(e);
                            lung2.material.specular = new THREE.Color(e);
                            lung3.material.specular = new THREE.Color(e);
                            lung4.material.specular = new THREE.Color(e);
                            lung5.material.specular = new THREE.Color(e);
                        });
                        aGUI.add(controls, "shininess_lung",0,200).onChange(function(e){
                            lung0.material.shininess = e;
                            lung1.material.shininess = e;
                            lung2.material.shininess = e;
                            lung3.material.shininess = e;
                            lung4.material.shininess = e;
                            lung5.material.shininess = e;
                        });
                    }
                    else if (e==3) {
                        scene.remove(heart0);
                        scene.remove(heart1);
                        scene.remove(heart2);
                        scene.remove(heart3);
                        scene.remove(heart4);
                        scene.remove(heart5);
                        scene.remove(lung0);
                        scene.remove(lung1);
                        scene.remove(lung2);
                        scene.remove(lung3);
                        scene.remove(lung4);
                        scene.remove(lung5);
                        scene.remove(brain);
                        scene.remove(u0);
                        scene.remove(u1);
                        scene.remove(u2);
                        scene.remove(u3);
                        scene.remove(u4);
                        gui.removeFolder("Lymphatic System");
                        gui.removeFolder("Brain");
                        gui.removeFolder("Heart");
                        gui.removeFolder("Lungs");

                        scene.add(u10);
                        scene.add(u11);
                        scene.add(u12);
                        scene.add(u13);
                        scene.add(u14);
                        scene.add(u15);
                        scene.add(u16);
                        scene.add(u17);
                        scene.add(u18);

                        objects = lis_object(3);
                        const aGUI = gui.addFolder("Gastrointestinal tract");
                        const a1GUI = aGUI.addFolder("color");
                        a1GUI.addColor(controls, "color0_u1").onChange(function(e){
                            u10.material.color = new THREE.Color(e);
                        });
                        a1GUI.addColor(controls, "color1_u1").onChange(function(e){
                            u11.material.color = new THREE.Color(e);
                        });
                        a1GUI.addColor(controls, "color2_u1").onChange(function(e){
                            u12.material.color = new THREE.Color(e);
                        });
                        a1GUI.addColor(controls, "color3_u1").onChange(function(e){
                            u13.material.color = new THREE.Color(e);
                        });
                        a1GUI.addColor(controls, "color4_u1").onChange(function(e){
                            u14.material.color = new THREE.Color(e);
                        });
                        a1GUI.addColor(controls, "color5_u1").onChange(function(e){
                            u15.material.color = new THREE.Color(e);
                        });
                        a1GUI.addColor(controls, "color6_u1").onChange(function(e){
                            u16.material.color = new THREE.Color(e);
                        });
                        a1GUI.addColor(controls, "color7_u1").onChange(function(e){
                            u17.material.color = new THREE.Color(e);
                        });
                        a1GUI.addColor(controls, "color8_u1").onChange(function(e){
                            u18.material.color = new THREE.Color(e);
                        });


                        const a2GUI = aGUI.addFolder("visible");
                        a2GUI.add(controls, "visible0_u1",true,false).onChange(function(e){
                            u10.visible = e;
                        });
                        a2GUI.add(controls, "visible1_u1",true,false).onChange(function(e){
                            u11.visible = e;
                        });
                        a2GUI.add(controls, "visible2_u1",true,false).onChange(function(e){
                            u12.visible = e;
                        });
                        a2GUI.add(controls, "visible3_u1",true,false).onChange(function(e){
                            u13.visible = e;
                        });
                        a2GUI.add(controls, "visible4_u1",true,false).onChange(function(e){
                            u14.visible = e;
                        });
                        a2GUI.add(controls, "visible5_u1",true,false).onChange(function(e){
                            u15.visible = e;
                        });
                        a2GUI.add(controls, "visible6_u1",true,false).onChange(function(e){
                            u16.visible = e;
                        });
                        a2GUI.add(controls, "visible7_u1",true,false).onChange(function(e){
                            u17.visible = e;
                        });
                        a2GUI.add(controls, "visible8_u1",true,false).onChange(function(e){
                            u18.visible = e;
                        });

                        
                        aGUI.add(controls, "wireframe_u1", true, false).onChange(function(e){
                            u11.material.wireframe = e;
                            u12.material.wireframe = e;
                            u10.material.wireframe = e;
                            u13.material.wireframe = e;
                            u14.material.wireframe = e;
                            u15.material.wireframe = e;
                            u16.material.wireframe = e;
                            u17.material.wireframe = e;
                            u18.material.wireframe = e;
                        });
                        aGUI.add(controls, "side_u1", {FrontSide:0, BackSide:1, BothSide:2}).onChange(function(e){
                            u10.material.side  = parseInt(e);
                            u11.material.side  = parseInt(e);
                            u12.material.side  = parseInt(e);
                            u13.material.side  = parseInt(e);
                            u14.material.side  = parseInt(e);
                            u15.material.side  = parseInt(e);
                            u16.material.side  = parseInt(e);
                            u17.material.side  = parseInt(e);
                            u18.material.side  = parseInt(e);
                        });
                        aGUI.add(controls, "shadowSide_u1", {FrontSide:0, BackSide:1, BothSide:2}).onChange(function(e){
                            u10.material.shadowSide  = parseInt(e);
                            u11.material.shadowSide  = parseInt(e);
                            u12.material.shadowSide  = parseInt(e);
                            u13.material.shadowSide  = parseInt(e);
                            u14.material.shadowSide  = parseInt(e);
                            u15.material.shadowSide  = parseInt(e);
                            u16.material.shadowSide  = parseInt(e);
                            u17.material.shadowSide  = parseInt(e);
                            u18.material.shadowSide  = parseInt(e);
                        });
                        aGUI.add(controls, "rotate_u1", true, false);
                        

                        aGUI.addColor(controls, "emissive_u1").onChange(function(e){
                            u10.material.emissive = new THREE.Color(e);
                            u11.material.emissive = new THREE.Color(e);
                            u12.material.emissive = new THREE.Color(e);
                            u13.material.emissive = new THREE.Color(e);
                            u14.material.emissive = new THREE.Color(e);
                            u15.material.emissive = new THREE.Color(e);
                            u16.material.emissive = new THREE.Color(e);
                            u17.material.emissive = new THREE.Color(e);
                            u18.material.emissive = new THREE.Color(e);
                        });
                        aGUI.addColor(controls, "specular_u1").onChange(function(e){
                            u10.material.specular = new THREE.Color(e);
                            u11.material.specular = new THREE.Color(e);
                            u12.material.specular = new THREE.Color(e);
                            u13.material.specular = new THREE.Color(e);
                            u14.material.specular = new THREE.Color(e);
                            u15.material.specular = new THREE.Color(e);
                            u16.material.specular = new THREE.Color(e);
                            u17.material.specular = new THREE.Color(e);
                            u18.material.specular = new THREE.Color(e);
                        });
                        aGUI.add(controls, "shininess_u1",0,200).onChange(function(e){
                            u10.material.shininess = e;
                            u11.material.shininess = e;
                            u12.material.shininess = e;
                            u13.material.shininess = e;
                            u14.material.shininess = e;
                            u15.material.shininess = e;
                            u16.material.shininess = e;
                            u17.material.shininess = e;
                            u18.material.shininess = e;
                        });
                    }

                    else {
                        scene.remove(heart0);
                        scene.remove(heart1);
                        scene.remove(heart2);
                        scene.remove(heart3);
                        scene.remove(heart4);
                        scene.remove(heart5);
                        scene.remove(lung0);
                        scene.remove(lung1);
                        scene.remove(lung2);
                        scene.remove(lung3);
                        scene.remove(lung4);
                        scene.remove(lung5);
                        scene.remove(brain);
                        scene.remove(u10);
                        scene.remove(u11);
                        scene.remove(u12);
                        scene.remove(u13);
                        scene.remove(u14);
                        scene.remove(u15);
                        scene.remove(u16);
                        scene.remove(u17);
                        scene.remove(u18);
                        gui.removeFolder("Gastrointestinal tract");
                        gui.removeFolder("Brain");
                        gui.removeFolder("Heart");
                        gui.removeFolder("Lungs");

                        scene.add(u0);
                        scene.add(u1);
                        scene.add(u2);
                        scene.add(u3);
                        scene.add(u4);

                        objects = lis_object(4);
                        const aGUI = gui.addFolder("Lymphatic System");
                        const a1GUI = aGUI.addFolder("color");
                        a1GUI.addColor(controls, "color0_u").onChange(function(e){
                            u0.material.color = new THREE.Color(e);
                        });
                        a1GUI.addColor(controls, "color1_u").onChange(function(e){
                            u1.material.color = new THREE.Color(e);
                        });
                        a1GUI.addColor(controls, "color2_u").onChange(function(e){
                            u2.material.color = new THREE.Color(e);
                        });
                        a1GUI.addColor(controls, "color3_u").onChange(function(e){
                            u3.material.color = new THREE.Color(e);
                        });
                        a1GUI.addColor(controls, "color4_u").onChange(function(e){
                            u4.material.color = new THREE.Color(e);
                        });

                        const a2GUI = aGUI.addFolder("visible");
                        a2GUI.add(controls, "visible0_u",true,false).onChange(function(e){
                            u0.visible = e;
                        });
                        a2GUI.add(controls, "visible1_u",true,false).onChange(function(e){
                            u1.visible = e;
                        });
                        a2GUI.add(controls, "visible2_u",true,false).onChange(function(e){
                            u2.visible = e;
                        });
                        a2GUI.add(controls, "visible3_u",true,false).onChange(function(e){
                            u3.visible = e;
                        });
                        a2GUI.add(controls, "visible4_u",true,false).onChange(function(e){
                            u4.visible = e;
                        });

                        
                        aGUI.add(controls, "wireframe_u", true, false).onChange(function(e){
                            u1.material.wireframe = e;
                            u2.material.wireframe = e;
                            u0.material.wireframe = e;
                            u3.material.wireframe = e;
                            u4.material.wireframe = e;
                        });
                        aGUI.add(controls, "side_u", {FrontSide:0, BackSide:1, BothSide:2}).onChange(function(e){
                            u0.material.side  = parseInt(e);
                            u1.material.side  = parseInt(e);
                            u2.material.side  = parseInt(e);
                            u3.material.side  = parseInt(e);
                            u4.material.side  = parseInt(e);
                        });
                        aGUI.add(controls, "shadowSide_u", {FrontSide:0, BackSide:1, BothSide:2}).onChange(function(e){
                            u0.material.shadowSide  = parseInt(e);
                            u1.material.shadowSide  = parseInt(e);
                            u2.material.shadowSide  = parseInt(e);
                            u3.material.shadowSide  = parseInt(e);
                            u4.material.shadowSide  = parseInt(e);
                        });
                        aGUI.add(controls, "rotate_u", true, false);
                        

                        aGUI.addColor(controls, "emissive_u").onChange(function(e){
                            u0.material.emissive = new THREE.Color(e);
                            u1.material.emissive = new THREE.Color(e);
                            u2.material.emissive = new THREE.Color(e);
                            u3.material.emissive = new THREE.Color(e);
                            u4.material.emissive = new THREE.Color(e);
                        });
                        aGUI.addColor(controls, "specular_u").onChange(function(e){
                            u0.material.specular = new THREE.Color(e);
                            u1.material.specular = new THREE.Color(e);
                            u2.material.specular = new THREE.Color(e);
                            u3.material.specular = new THREE.Color(e);
                            u4.material.specular = new THREE.Color(e);
                        });
                        aGUI.add(controls, "shininess_u",0,200).onChange(function(e){
                            u0.material.shininess = e;
                            u1.material.shininess = e;
                            u2.material.shininess = e;
                            u3.material.shininess = e;
                            u4.material.shininess = e;
                        });
                    }
                }); 
            } else {
                scene.remove(brain);
                scene.remove(heart0);
                scene.remove(heart1);
                scene.remove(heart2);
                scene.remove(heart3);
                scene.remove(heart4);
                scene.remove(heart5);
                scene.remove(lung0);
                scene.remove(lung1);
                scene.remove(lung2);
                scene.remove(lung3);
                scene.remove(lung4);
                scene.remove(lung5);
                //scene.add(cube);
                objects = [];
                gui_main.removeFolder("Medicine");
                const gui = gui_main.addFolder("Math");
                let dropList = gui.add(controls, "geometry", {"Cube":0, "Sphere":1, "Circle":2, "Torus":3, "TorusKnot":4});
                dropList.setValue(0);
                dropList.onChange(function(e){
                    if (e==0){
                        scene.remove(sphere);
                        scene.remove(circle);
                        scene.remove(torus);
                        scene.remove(torusknot);
                        gui.removeFolder("Torusknot");
                        gui.removeFolder("Torus");
                        gui.removeFolder("Circle");
                        gui.removeFolder("Sphere");

                        scene.add(cube);
                        const aGUI = gui.addFolder("Cube");
                        aGUI.add(controls, "material_cube", {"Lambert":0, "Normal": 1}).onChange(function(e){
                            switch (parseInt(e)){
                                case 0: 
                                    cube.material = cubeMat;
                                    break;
                                case 1: 
                                    cube.material = cubeMat2;
                                    break;
                            }
                        });
                        aGUI.addColor(controls, "color_cube").onChange(function(e){
                            cube.material.color = new THREE.Color(e);
                        });
                        aGUI.add(controls, "rotate_cube", true, false);
                        aGUI.add(controls, "side_cube", {FrontSide:0, BackSide:1, BothSide:2}).onChange(function(e){
                            cube.material.side  = parseInt(e);
                        });
                        aGUI.add(controls, "shadowSide_cube", {FrontSide:0, BackSide:1, BothSide:2}).onChange(function(e){
                            cube.material.shadowSide  = parseInt(e);
                        }); 
                        aGUI.add(controls, "wireframe_cube", true, false).onChange(function(e){
                            cube.material.wireframe = e;
                        });
                        aGUI.add(controls, "width_cube", 0.1, 100).onChange(function(){controls.redraw_cube()});
                        aGUI.add(controls, "height_cube", 0.1, 100).onChange(function(){controls.redraw_cube()});
                        aGUI.add(controls, "depth_cube", 0.1, 100).onChange(function(){controls.redraw_cube()});
                        aGUI.add(controls, "widthSegments_cube", 0.1, 100).step(1).onChange(function(){controls.redraw_cube()});
                        aGUI.add(controls, "heightSegments_cube", 0.1, 100).step(1).onChange(function(){controls.redraw_cube()});
                        aGUI.add(controls, "depthSegments_cube", 0.1, 100).step(1).onChange(function(){controls.redraw_cube()});
                        //selectedMesh = cube;
                    } 
                    else if (e==1) {
                        scene.remove(cube);
                        scene.remove(circle);
                        scene.remove(torus);
                        scene.remove(torusknot);
                        gui.removeFolder("Torusknot");
                        gui.removeFolder("Torus");
                        gui.removeFolder("Circle");
                        gui.removeFolder("Cube");

                        scene.add(sphere);
                        
                        const aGUI = gui.addFolder("Sphere");
                        aGUI.add(controls, "material_sphere", {"Lambert":0, "Normal": 1}).onChange(function(e){
                            switch (parseInt(e)){
                                case 0: 
                                    sphere.material = sphereMat;
                                    break;
                                case 1: 
                                    sphere.material = sphereMat2;
                                    break;
                            }
                        });
                        aGUI.addColor(controls, "color_sphere").onChange(function(e){
                            sphere.material.color = new THREE.Color(e);
                        });
                        aGUI.add(controls, "rotate_sphere", true, false);
                        aGUI.add(controls, "side_sphere", {FrontSide:0, BackSide:1, BothSide:2}).onChange(function(e){
                            sphere.material.side  = parseInt(e);
                        });
                        aGUI.add(controls, "shadowSide_sphere", {FrontSide:0, BackSide:1, BothSide:2}).onChange(function(e){
                            sphere.material.shadowSide  = parseInt(e);
                        }); 
                        aGUI.add(controls, "wireframe_sphere", true, false).onChange(function(e){
                            sphere.material.wireframe = e;
                        });
                        /* aGUI.add(controls, "castShadow", true, false).onChange(function(e){
                            sphere.castShadow = e;
                        }); */

                        aGUI.add(controls, "radius", 1, 50).onChange(function(){controls.redraw()});
                        aGUI.add(controls, "widthSegments", 2, 64).step(1).onChange(function(){controls.redraw()});
                        aGUI.add(controls, "heightSegments", 2, 64).step(1).onChange(function(){controls.redraw()});
                        /* aGUI.add(controls, "thetaStart", 0, 2*Math.PI).onChange(function(e){
                            sphere.geometry.parameters.thetaStart = e;
                        }); */

                        aGUI.add(controls, "phiStart", 0, 2*Math.PI).onChange(function(){controls.redraw()});
                        aGUI.add(controls, "phiLength", 0, 2*Math.PI).onChange(function(){controls.redraw()});
                        aGUI.add(controls, "thetaStart", 0, Math.PI).onChange(function(){controls.redraw()});
                        aGUI.add(controls, "thetaLength", 0, Math.PI).onChange(function(){controls.redraw()});


                        //selectedMesh = heart0;
                    }
                    else if (e==2) {
                        scene.remove(cube);
                        scene.remove(sphere);
                        scene.remove(torus);
                        scene.remove(torusknot);
                        gui.removeFolder("Torusknot");
                        gui.removeFolder("Torus");
                        gui.removeFolder("Cube");
                        gui.removeFolder("Sphere");

                        scene.add(circle);                     
                        const aGUI = gui.addFolder("Circle");
                        aGUI.add(controls, "material_circle", {"Lambert":0, "Normal": 1}).onChange(function(e){
                            switch (parseInt(e)){
                                case 0: 
                                    circle.material = circleMat;
                                    break;
                                case 1: 
                                    circle.material = circleMat2;
                                    break;
                            }
                        });
                        aGUI.addColor(controls, "color_circle").onChange(function(e){
                            circle.material.color = new THREE.Color(e);
                        });
                        aGUI.add(controls, "rotate_circle", true, false);
                        aGUI.add(controls, "side_circle", {FrontSide:0, BackSide:1, BothSide:2}).onChange(function(e){
                            circle.material.side  = parseInt(e);
                        });
                        aGUI.add(controls, "shadowSide_circle", {FrontSide:0, BackSide:1, BothSide:2}).onChange(function(e){
                            circle.material.shadowSide  = parseInt(e);
                        });
                        aGUI.add(controls, "wireframe_circle", true, false).onChange(function(e){
                            circle.material.wireframe = e;
                        });                    
                        aGUI.add(controls, "radius_circle", 1, 80).onChange(function(){controls.redraw_circle()});
                        aGUI.add(controls, "segments_circle", 2, 100).step(1).onChange(function(){controls.redraw_circle()});
                        /*        aGUI.add(controls, "thetaStart", 0, 2*Math.PI).onChange(function(e){
                            circle.geometry.parameters.thetaStart = e;
                        });*/

                        aGUI.add(controls, "thetaStart_circle", 0, 2*Math.PI).onChange(function(){controls.redraw_circle()});
                        aGUI.add(controls, "thetaLength_circle", 0, 2*Math.PI).onChange(function(){controls.redraw_circle()});

                    }
                    else if (e==3){
                        scene.remove(cube);
                        scene.remove(sphere);
                        scene.remove(circle);
                        scene.remove(torusknot);
                        gui.removeFolder("Torusknot");
                        gui.removeFolder("Cube");
                        gui.removeFolder("Sphere");
                        gui.removeFolder("Circle");

                        scene.add(torus);
                        const aGUI = gui.addFolder("Torus");
                        aGUI.add(controls, "material_torus", {"Lambert":0, "Normal": 1}).onChange(function(e){
                            switch (parseInt(e)){
                                case 0: 
                                    torus.material = torusMat;
                                    break;
                                case 1: 
                                    torus.material = torusMat2;
                                    break;
                            }
                        });
                        aGUI.addColor(controls, "color_torus").onChange(function(e){
                            torus.material.color = new THREE.Color(e);
                        });
                        aGUI.add(controls, "rotate_torus", true, false);
                        aGUI.add(controls, "side_torus", {FrontSide:0, BackSide:1, BothSide:2}).onChange(function(e){
                            torus.material.side  = parseInt(e);
                        });
                        aGUI.add(controls, "shadowSide_torus", {FrontSide:0, BackSide:1, BothSide:2}).onChange(function(e){
                            torus.material.shadowSide  = parseInt(e);
                        });
                        aGUI.add(controls, "wireframe_torus", true, false).onChange(function(e){
                            torus.material.wireframe = e;
                        });
                        aGUI.add(controls, "radius_torus", 1, 50).onChange(function(){controls.redraw_torus()});
                        aGUI.add(controls, "tube_torus", 0.1, 20).onChange(function(){controls.redraw_torus()});
                        aGUI.add(controls, "radialSegments_torus", 2, 100).step(1).onChange(function(){controls.redraw_torus()});
                        aGUI.add(controls, "tubularSegments_torus", 2, 100).step(1).onChange(function(){controls.redraw_torus()});
                        aGUI.add(controls, "arc_torus", 0, 2*Math.PI).onChange(function(){controls.redraw_torus()});

                    }
                    else {
                        scene.remove(cube);
                        scene.remove(sphere);
                        scene.remove(circle);
                        scene.remove(torus);
                        gui.removeFolder("Torus");
                        gui.removeFolder("Cube");
                        gui.removeFolder("Sphere");
                        gui.removeFolder("Circle");

                        scene.add(torusknot);
                        const aGUI = gui.addFolder("Torusknot");
                        aGUI.add(controls, "material_torusknot", {"Lambert":0, "Normal": 1}).onChange(function(e){
                            switch (parseInt(e)){
                                case 0: 
                                    torusknot.material = torusknotMat;
                                    break;
                                case 1: 
                                    torusknot.material = torusknotMat2;
                                    break;
                            }
                        });
                        aGUI.addColor(controls, "color_torusknot").onChange(function(e){
                            torusknot.material.color = new THREE.Color(e);
                        });
                        aGUI.add(controls, "rotate_torusknot", true, false);
                        aGUI.add(controls, "side_torusknot", {FrontSide:0, BackSide:1, BothSide:2}).onChange(function(e){
                            torusknot.material.side  = parseInt(e);
                        });
                        aGUI.add(controls, "shadowSide_torusknot", {FrontSide:0, BackSide:1, BothSide:2}).onChange(function(e){
                            torusknot.material.shadowSide  = parseInt(e);
                        });
                        aGUI.add(controls, "wireframe_torusknot", true, false).onChange(function(e){
                            torusknot.material.wireframe = e;
                        });
                        aGUI.add(controls, "radius_torusknot", 1, 50).onChange(function(){controls.redraw_torusknot()});
                        aGUI.add(controls, "tube_torusknot", 0.1, 20).onChange(function(){controls.redraw_torusknot()});
                        aGUI.add(controls, "radialSegments_torusknot", 2, 200).step(1).onChange(function(){controls.redraw_torusknot()});
                        aGUI.add(controls, "tubularSegments_torusknot", 2, 100).step(1).onChange(function(){controls.redraw_torusknot()});
                        aGUI.add(controls, "p_torusknot", 1, 10).step(1).onChange(function(){controls.redraw_torusknot()});
                        aGUI.add(controls, "q_torusknot", 1, 10).step(1).onChange(function(){controls.redraw_torusknot()});
                    }
                }); 
            }
        });

        window.addEventListener("contextmenu", raycastClick);

        // ---------- Raycasters ----------
        //Raycasting được sử dụng để chọn chuột (tìm ra đối tượng nào trong không gian 3d mà chuột đi qua) trong số những thứ khác.
        const clickRaycaster = new THREE.Raycaster();
        let intersects = [];
        let mouseNDC = new THREE.Vector2();
        let mouse = new THREE.Vector2();
        let intersectedObject = null

        // ---------- Popup ----------
        const popUp = document.createElement("div");
        popUp.id = "popUp";
        popUp.style.position = "absolute";
        let positionPopupProjected = new THREE.Vector3(); // khai bao popup
        let positionPopup = new THREE.Vector3(); //vi tri pop
        let popUpX = 0;
        let popUpY = 0;

        //click victoria
        function raycastClick(event){
            event.preventDefault();
            mouse.x = event.clientX;
            mouse.y = event.clientY;
            mouseNDC.x = ( event.clientX / window.innerWidth ) * 2 - 1;
            mouseNDC.y = - ( event.clientY / window.innerHeight ) * 2 + 1;

            clickRaycaster.setFromCamera( mouseNDC, cam );
            intersects = clickRaycaster.intersectObjects(objects);

            if(!intersects.length || intersects[0].object.id === intersectedObject?.id){
                if(!intersectedObject) return
                intersectedObject = null;
                togglePopup(false)
                return;
            }

            intersectedObject = intersects[0].object;
            positionPopup = intersects[0].point;   
            let state = calculatePopUpPosition(cam)
            togglePopup(state)
        }
        //tao popup
        function togglePopup(state) {
            if(!state){
                if(document.getElementById("popUp")) document.body.removeChild(popUp)
                return
            }
            popUp.innerHTML = intersectedObject.name
            popUp.style.top = popUpY+"px"
            popUp.style.left = popUpX+"px"
            document.body.append(popUp)
        }
        //tinh vi tri dat pop
        function calculatePopUpPosition(camera){
            positionPopupProjected.copy(positionPopup);
            positionPopupProjected.project(camera);
            if ((positionPopupProjected.x > -1 && positionPopupProjected.x < 1) &&
                (positionPopupProjected.y > -1 && positionPopupProjected.y < 1)) {

                popUpX = Math.floor((positionPopupProjected.x + 1) * 0.5 * window.innerWidth);
                popUpY = Math.floor(-(positionPopupProjected.y - 1) * 0.5 * window.innerHeight);
                return true;
            }else{
                return false;
            }
        }
        //cap nhat pop
        function updatePopUpPosition(state){
            if(!document.getElementById("popUp")) return
            popUp.style.top = popUpY+"px"
            popUp.style.left = popUpX+"px"
            if(!state) popUp.style.display = "none"
            else popUp.style.display = "block"
        }

        //ve hinh
        let alpha = 0;
        const step = 0.02;
        const t = 0.05;
        const clock = new THREE.Clock();
        function myRender(){
            const delta = clock.getDelta();
            orbitControls.update(delta);
            let state = calculatePopUpPosition(cam);
            updatePopUpPosition(state);

            //rotation
            if (controls.rotate_cube){
                cube.rotateX(0.03);
                cube.rotateY(0.03);
                cube.rotateZ(0.03);
            };
            if (controls.rotate_sphere){
                sphere.rotateX(0.03);
                sphere.rotateY(0.03);
                sphere.rotateZ(0.03);
            };
            if (controls.rotate_circle){
                circle.rotateX(0.05);
                circle.rotateY(0.05);
                circle.rotateZ(0.05);
            };
            if (controls.rotate){
                heart0.rotateX(0.03);
                heart0.rotateY(0.03);
                heart0.rotateZ(0.03);
                heart1.rotateX(0.03);
                heart1.rotateY(0.03);
                heart1.rotateZ(0.03);
                heart2.rotateX(0.03);
                heart2.rotateY(0.03);
                heart2.rotateZ(0.03);
                heart3.rotateX(0.03);
                heart3.rotateY(0.03);
                heart3.rotateZ(0.03);
                heart4.rotateX(0.03);
                heart4.rotateY(0.03);
                heart4.rotateZ(0.03);
                heart5.rotateX(0.03);
                heart5.rotateY(0.03);
                heart5.rotateZ(0.03);
            };
            if (controls.rotate_torus){
                torus.rotateX(0.03);
                torus.rotateY(0.03);
                torus.rotateZ(0.03);
            };
            if (controls.rotate_torusknot){
                torusknot.rotateX(0.03);
                torusknot.rotateY(0.03);
                torusknot.rotateZ(0.03);
            };
            if (controls.rotate_brain){
                brain.rotateX(0.03);
                brain.rotateY(0.03);
                brain.rotateZ(0.03);
            };
            if (controls.rotate_lung){
                lung0.rotateX(0.03);
                lung0.rotateY(0.03);
                lung0.rotateZ(0.03);
                lung1.rotateX(0.03);
                lung1.rotateY(0.03);
                lung1.rotateZ(0.03);
                lung2.rotateX(0.03);
                lung2.rotateY(0.03);
                lung2.rotateZ(0.03);
                lung3.rotateX(0.03);
                lung3.rotateY(0.03);
                lung3.rotateZ(0.03);
                lung4.rotateX(0.03);
                lung4.rotateY(0.03);
                lung4.rotateZ(0.03);
                lung5.rotateX(0.03);
                lung5.rotateY(0.03);
                lung5.rotateZ(0.03);
            };

            window.requestAnimationFrame(myRender);
            renderer.render(scene, cam);
        }
        myRender();
    }
    init();
</script>
</body>
</html>